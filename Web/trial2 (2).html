<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/two.js/0.8.11/two.min.js"></script>
</head>

<body>
    <script>
        var params = {
            fullscreen: true
        };
        var elem = document.body;
        var two = new Two(params).appendTo(elem);

        var rect = two.makeRectangle(two.width / 2, two.height / 2 - 200);
        var rect1 = two.makeRectangle(two.width / 2 - 300, two.height / 2);
        var rect2 = two.makeRectangle(two.width / 2 - 100, two.height / 2);
        var rect3 = two.makeRectangle(two.width / 2 + 100, two.height / 2);
        var rect4 = two.makeRectangle(two.width / 2 + 300, two.height / 2);
        var rect5 = two.makeRectangle(two.width / 2 - 300, two.height / 2 + 200);
        var rect6 = two.makeRectangle(two.width / 2 - 100, two.height / 2 + 200);
        var rect7 = two.makeRectangle(two.width / 2 + 100, two.height / 2 + 200);
        var rect8 = two.makeRectangle(two.width / 2 + 300, two.height / 2 + 200);

        var rectangles = [rect, rect1, rect2, rect3, rect4, rect5, rect6, rect7, rect8];

        rectangles.forEach(rectangle => rectangle.noStroke());

        function drawDetailsForRectangle(rectangle, colors) {
            var x = rectangle.translation.x;
            var y = rectangle.translation.y;

            // "X" inside rect
            rectangle.line1 = two.makeLine(x - 50, y - 50, x + 50, y + 50);
            rectangle.line2 = two.makeLine(x - 50, y + 50, x + 50, y - 50);

            // "+" inside rect
            rectangle.line7 = two.makeLine(x, y - 50, x, y + 50);
            rectangle.line8 = two.makeLine(x - 50, y, x + 50, y);

            // Border lines for the rectangle
            rectangle.line3 = two.makeLine(x - 50, y - 50, x + 50, y - 50);
            rectangle.line4 = two.makeLine(x - 50, y + 50, x + 50, y + 50);
            rectangle.line5 = two.makeLine(x - 50, y - 50, x - 50, y + 50);
            rectangle.line6 = two.makeLine(x + 50, y - 50, x + 50, y + 50);

            [rectangle.line1, rectangle.line2, rectangle.line7, rectangle.line8, rectangle.line3, rectangle.line4, rectangle.line5, rectangle.line6].forEach(line => {
                line.stroke = colors[Math.floor(Math.random() * colors.length)];
            });
        }

        var commonColors = ['black'];

        rectangles.forEach(rectangle => {
            drawDetailsForRectangle(rectangle, commonColors);
        });

        function generateRandomPattern(rectangle) {
            let lines = ['line1', 'line2', 'line7', 'line8', 'line3', 'line4', 'line5'];
            let pattern = [];
            let hiddenLines = [];
            let numOfAbsentLines = Math.floor(Math.random() * 5) + 1;

            for (let i = 0; i < numOfAbsentLines; i++) {
                let randomIndex = Math.floor(Math.random() * lines.length);
                let lineName = lines.splice(randomIndex, 1)[0];
                pattern.push(rectangle[lineName]);
                hiddenLines.push(lineName);
            }

            return { pattern, hiddenLines };
        }

        function applyPatternToRectangles(rectangles, pattern) {
            rectangles.forEach(rectangle => {
                pattern.pattern.forEach(line => {
                    line.visible = false;
                });
            });
        }

        function applyRandomPatternToRectangles(rectangles, count) {
            let randomRectangles = [];

            while (randomRectangles.length < count) {
                let randomRectIndex = Math.floor(Math.random() * rectangles.length);
                if (!randomRectangles.includes(randomRectIndex)) {
                    randomRectangles.push(randomRectIndex);
                }
            }

            randomRectangles.forEach(index => {
                let patternData = generateRandomPattern(rectangles[index]);
                applyPatternToRectangles(rectangles, patternData);
            });
        }

        // Apply the pattern to 'rect' and three random rectangles
        applyPatternToRectangles([rect], generateRandomPattern(rect));
        applyRandomPatternToRectangles(rectangles.filter(r => r !== rect), 3);

        two.update();
    </script>
</body>

</html>
